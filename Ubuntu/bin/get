#!/bin/bash -e

# -------------------------------------------------------------------------------------------------
# Functions
# -------------------------------------------------------------------------------------------------
BASEDIR=$(dirname $(readlink -f ${0}))
BASENAME=$(basename ${0})

function usage {
  echo "Usage: ${BASENAME} [<dir>] [<pattern to find>] [ -- <additional arguments to find>]"
  echo "Default <dir>    : '.'"
  echo "Default <pattern>: ''"
  exit 0
}

function dieUsage {
  echo "Error ${1}"
  usage
  exit 1
}

# -------------------------------------------------------------------------------------------------
# Parse Arg
# -------------------------------------------------------------------------------------------------
if [[ ${#} -eq 1 && ("${1}" == "-h" || "${1}" == "--help") ]]
then
  usage
fi

# Declare an associative array
# Add all arg before '--' in the array
declare -a arg=()
while [[ ! -z "$1" && "$1" != "--" ]]
do
  arg=("${arg[@]}" "$1")
  shift
done

if [[ "$1" == "--" ]]
then
  shift
fi

# Now we have all the arguments before '--' in arg and the rest in $@  
dir="."
if [[ ${#arg[@]} -eq 1 ]]
then
  pattern=${arg[0]}
elif [[ ${#arg[@]} -eq 2 ]]
then
  dir=${arg[0]}
  pattern=${arg[1]}
fi

# -------------------------------------------------------------------------------------------------
# Main
# -------------------------------------------------------------------------------------------------
if [[ ${#arg[@]} -eq 0 ]]
then
  find ${dir} "${@}"
else
  find ${dir} -name "$pattern" "${@}"
fi
