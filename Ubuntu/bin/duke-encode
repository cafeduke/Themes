#!/bin/bash

# -------------------------------------------------------------------------------------------------
# Functions
# -------------------------------------------------------------------------------------------------
BASEDIR=$(dirname $(readlink -f ${0}))
BASENAME=$(basename ${0})

# Source util
source ${BASEDIR}/duke-util.sh

function usage {
  echo "Encode <plain-file> and save as <encoded-file>. The command prompts for password."
  echo "Usage: ${BASENAME} <plain-file> <encoded-file>"
}

# -------------------------------------------------------------------------------------------------
# Parse Arg
# -------------------------------------------------------------------------------------------------
if [[ ${#} -eq 1 && ("${1}" == "--help" || "${1}" == "-h") ]]
then
  usage
  exit 0
fi

if [[ ${#} -ne 2 ]]
then
  dieUsage "Invalid argument count"
fi

filePlain="${1}"
fileEncode="${2}"

# -------------------------------------------------------------------------------------------------
# Main
# -------------------------------------------------------------------------------------------------
gpg --symmetric --no-symkey-cache ${filePlain}
if [[ "${fileEncode}" != "${filePlain}.gpg" ]]
then
  mv ${filePlain}.gpg ${fileEncode}
fi
