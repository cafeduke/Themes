#!/bin/bash -e

# -------------------------------------------------------------------------------------------------
# Functions
# -------------------------------------------------------------------------------------------------
BASEDIR=$(dirname $(readlink -f ${0}))
BASENAME=$(basename ${0})

# Source util
source ${BASEDIR}/duke-util.sh

function usage {
  echo "List patches"
  echo "Usage  : ${BASENAME} <email> <patch-id> <patch-zip-file>"
  echo "Example: ${BASENAME} raghunandan.seshadri@oracle.com 33779451 p33779451_121020_Linux-x86-64.zip"
}

# -------------------------------------------------------------------------------------------------
# Parse Arg
# -------------------------------------------------------------------------------------------------
if [[ ${#} -eq 1 && ("${1}" == "-h" || "${1}" == "--help") ]]
then
  usage
  exit 0
fi

if [[ ${#} -ne 3 ]]
then
  dieUsage "Invalid argument count"
fi

email="${1}"
bug="${2}"
fileZip="${3}"

# -------------------------------------------------------------------------------------------------
# Main
# -------------------------------------------------------------------------------------------------
heading "Downloading ${fileZip}"
echo "Executing: wget --no-check-certificate --no-proxy --no-verbose --http-user=${email} --ask-password https://aru.oraclecorp.com/api/v2/download/${bug}/${fileZip} -O ${fileZip}"
wget --no-check-certificate --no-proxy --no-verbose --http-user=${email} --ask-password "https://aru.oraclecorp.com/api/v2/download/${bug}/${fileZip}" -O "${fileZip}"
